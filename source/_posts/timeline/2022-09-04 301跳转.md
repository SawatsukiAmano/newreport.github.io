---
title: Cloudflare 301 跳转 # 主题
date: 2022-09-04 00:00:00 # 时间
tags: # 标签
 - Http
urlname: cloudflare-301-url
categories:  timeline
tags: 
- Domain
copyright: true
---
# 购买域名、注册cloudflare账号
cloudflare官网：https://www.cloudflare.com/

namesilo官网：https://www.namesilo.com/

dnspod官网：https://www.dnspod.cn/

> 注意：如果不想 whois 查询到个人信息，建议非主流域名在 [namesilo](https://www.namesilo.com/) 购买，可以有免费的whois信息隐藏。

> dnspod 仅支持 .com、.net等主流的一级域名进行whois隐藏，但不支持如.top、.xyz、.live等域名的信息隐藏，也就是说whois查询能查询到本名（开盒
<!-- more -->  
# 添加NS解析
## cloudflare中添加域名
![添加域名](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/5F340345564EACF17BCA4B89B1E262779A2D32CABDE4F6E494D45E40FD42A7D2.png)

![选择免费](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/3528E49703BABDB9EE3B5E63E5A63EAE32C75D99FE32A1E2F7249A62FD1B7DE3.png)

![](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/4C146869F59CF5BF6400C5CE2CB63F98186F4DF75CFE5F86F720457FA97E01E9.png)

![复制两个NS值](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/829C11EA78DD0E39B8D94FA4DCAA06CC104F451282F6CC014D92CE7431C6A94C.png)

## dnspod修改ns服务器
> https://console.cloud.tencent.com/domain/all-domain

![NS记录填写到这里](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/63CDA084EA205938EFDD34965DA0B14777989D16F72A4BF9FCBAD5CABCE6F827.png)

## namesilo修改ns服务器
> https://www.namesilo.com/account_domains.php

![选择域名](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/B5DDEDA418F36157C835DA235BA775A9AC354B93EE763D05C05F83CADC9A77D5.png)


![修改NameServer](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/9FDF844D910F637DEB6C82647EC4E10E232B109A22E974EBEC582E07597BB683.png)

# 添加DNS解析和Workers

![编辑Workers](https://gd-obj-001.gd2.qingstor.com/haruki/blog/cn/2022/36C2EE20809A34E19037B12D9B2971DB4EF122F94257EDDE75CB0B5D11D98360.png)


```JavaScript
const rules = [
{"oldurl":"short-test.newreport.top","newurl":"newreport.top/2022-09-04/cloudflare-301-url"},

];

async function handleRequest(request) {
    let url = request.url;
    let hostname = new URL(request.url).hostname;
    let isExist = false;
    for (var i = 0, l = rules.length; i < l; i++) {
        if (rules[i].oldurl == hostname) {
            url = url.replace(rules[i].oldurl, rules[i].newurl);
            isExist = true;
            // url = url.replace(/([\w\W]+)\/$/,"$1");//删除最后一个/
            break;
        }
    }
    if (isExist) {
        return Response.redirect(new URL(url), 301);
    }
    return fetch(request)
}

addEventListener('fetch', async event => {
    event.respondWith(handleRequest(event.request))
});
```
> 验证 https://short-test.newreport.top